<!DOCTYPE html>
<html> 
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1"> 
        <title>html5expense</title> 
        <link rel="stylesheet" href="jquery.mobile-1.0b2.min.css" />
        <script type="text/javascript" src="jquery-1.6.2.min.js"></script>
        <script type="text/javascript" src="jquery.mobile-1.0b2.min.js"></script>
        <script type="text/javascript" src="jquery.formatCurrency-1.4.0.js"></script>
    </head> 
    
    <body>
                
        <!-- Start of Home page -->
        <div data-role="page" id="home">
            
            <div data-role="header">
                <h1>Home</h1>
            </div><!-- /header -->
            
            <div data-role="content">
                <ul data-role="listview">
                    <li><a href="#create-new-purpose">Create New</a></li>
                    <li><a href="#review-status">Review Status</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#sign-in" data-rel="dialog">Sign Out</a></li>
                </ul>
            </div><!-- /content -->
            
            <div data-role="footer">
                <h4>Page Footer</h4>
            </div><!-- /footer -->
        </div><!-- /page -->
        
        <!-- Start of Sign In page -->
        <div data-role="page" id="sign-in">
            <div data-role="header">
                <h1>Sign In</h1>
            </div><!-- /header -->
            
            <div data-role="content">
                <form method="get" action="#home" data-transition="slidedown">
                    <div data-role="fieldcontain" class="ui-field-contain">
                        <label for="username">Username:</label>
                        <input type="text" name="username" id="username" value="" />
                    </div>
                    <div data-role="fieldcontain" class="ui-field-contain">
                        <label for="password">Password:</label>
                        <input type="password" name="password" id="password" value="" />
                    </div>
                    <div class="ui-body">
                        <button type="submit">Sign In</button>
                    </div>
                </form>
            </div><!-- /content -->
            
            <div data-role="footer">
                <h4>Page Footer</h4>
            </div><!-- /footer -->
        </div><!-- /page -->
        
        <!-- Start of Review Status page -->
        <div data-role="page" id="about" data-add-back-btn="true">
            
            <div data-role="header">
                <h1>About</h1>
            </div><!-- /header -->
            
            <div data-role="content">
                <p>Copyright 2011 SpringSource</p>
                <p>TODO: Add about info</p>
            </div><!-- /content -->
            
            <div data-role="footer">
                <h4>Page Footer</h4>
            </div><!-- /footer -->
        </div><!-- /page -->
        
        <script type="text/javascript">
            var reportId;
            
            function onSuccess(data, status) {
                reportId = $.trim(data);
                $.mobile.changePage($("#create-new-expenses"));
            }

            function onError(data, status) {
                //TODO: handle error
            }

            $('#create-new-purpose').live('pagecreate', function(event){
                $("#create-new-next").click(function(){

                    var formData = $("#create-new-purpose-form").serialize();

                    $.ajax({
                        type: "POST",
                        url: "http://10.0.2.2:8080/api/reports/",
                        cache: false,
                        data: formData,
                        success: onSuccess,
                        error: onError
                    });

                    return false;
                });
            });
        </script>
        
        <!-- Start of Create New - Purpose page -->
        <div data-role="page" id="create-new-purpose" data-add-back-btn="true">
            
            <div data-role="header">
                <h1>Create New</h1>
            </div><!-- /header -->
            
            <div data-role="content">
                <form id="create-new-purpose-form">
                    <div data-role="fieldcontain" class="ui-field-contain">
                        <label for="purpose">Purpose:</label>
                        <input type="text" name="purpose" id="purpose" value="" />
                    </div>
                    <div class="ui-body">
                        <fieldset class="ui-grid-a">
                            <div class="ui-block-a"><a href="#home" data-role="button">Cancel</a></div>
                            <div class="ui-block-b"><button id="create-new-next" type="submit">Next</button></div>    
                        </fieldset>
                    </div>
                </form>
            </div><!-- /content -->
            
            <div data-role="footer">
                <h4>Page Footer</h4>
            </div><!-- /footer -->
        </div><!-- /page -->
        
        <script type="text/javascript">
            $('#create-new-expenses').live('pagecreate', function(event){
                $("#create-new-expenses-next").click(function(){
                    $.mobile.changePage($("#create-new-add-receipt"));
                    return false;
                });
            });
            
            $('#create-new-expenses').live('pageshow', function(event, ui){
                
                // display loading spinner
                $.mobile.showPageLoadingMsg();
            
                // dynamically create the list of checkboxes
                $.getJSON("http://10.0.2.2:8080/api/reports/eligible-charges",
                    function(data){
                        var content = '<fieldset data-role="controlgroup">';
                        $.each(data, function(i, charge){
                            var id = 'checkbox-' + i;
                            content += '<input type="checkbox" name="' + id + '" id="' + id + '" class="custom" />';
                            content += '<label for="' + id + '">' + charge.date + ' - ' + charge.amount + ' - ' + charge.merchant + '</label>';
                        });
                        content += '</fieldset>';
                        
                        // set the content and trigger the create event to refresh and format the list properly 
                        $('#charges-list').append(content).trigger('create');
                        
                        // hide loading spinner
                        $.mobile.hidePageLoadingMsg();
                });
            });
        </script>
        
        <!-- Start of Create New - Expenses page -->
        <div data-role="page" id="create-new-expenses" data-add-back-btn="true">
            
            <div data-role="header">
                <h1>Select Expenses</h1>
            </div><!-- /header -->
            
            <div data-role="content">
                <form id="create-new-expenses-form">
                    <div data-role="fieldcontain" id="charges-list">
                    </div>
                    <div class="ui-body">
                        <fieldset class="ui-grid-a">
                            <div class="ui-block-a"><a href="#home" data-role="button">Cancel</a></div>
                            <div class="ui-block-b"><button id="create-new-expenses-next" type="submit">Next</button></div>    
                        </fieldset>
                    </div>
                </form>
            </div><!-- /content -->
            
            <div data-role="footer">
                <h4>Page Footer</h4>
            </div><!-- /footer -->
        </div><!-- /page -->
        
        <!-- Start of Create New - Add Receipt page -->
        <div data-role="page" id="create-new-add-receipt" data-add-back-btn="true">
            
            <div data-role="header">
                <h1>Add Receipt</h1>
            </div><!-- /header -->
            
            <div data-role="content">
                <form method="get" action="#create-new-confirm">
                    <p>TODO: add option to capture photo</p>
                    <div class="ui-body">
                        <fieldset class="ui-grid-a">
                            <div class="ui-block-a"><button type="submit">Cancel</button></div>
                            <div class="ui-block-b"><button type="submit">Next</button></div>    
                        </fieldset>
                    </div>
                </form>
            </div><!-- /content -->
            
            <div data-role="footer">
                <h4>Page Footer</h4>
            </div><!-- /footer -->
        </div><!-- /page -->

        <!-- Start of Create New - Confirm page -->
        <div data-role="page" id="create-new-confirm" data-add-back-btn="true">
            
            <div data-role="header">
                <h1>Confirm</h1>
            </div><!-- /header -->
            
            <div data-role="content">
                <form method="get" action="#home">
                    <p>TODO: display list of expenses</p>
                    <div class="ui-body">
                        <fieldset class="ui-grid-a">
                            <div class="ui-block-a"><button type="submit">Cancel</button></div>
                            <div class="ui-block-b"><button type="submit">Save</button></div>    
                        </fieldset>
                    </div>
                </form>
            </div><!-- /content -->
            
            <div data-role="footer">
                <h4>Page Footer</h4>
            </div><!-- /footer -->
        </div><!-- /page -->
        
        <script type="text/javascript">
            $('#review-status').live('pageshow', function(event, ui){

                // display loading spinner
                $.mobile.showPageLoadingMsg();

                // dynamically create the list of open reports
                $.getJSON("http://10.0.2.2:8080/api/reports",
                    function(data){
                        var content = "";
                        $.each(data, function(i, report){
                            if (report.purpose != null) {
                                content += '<li><a href="#create-new-confirm">' + report.purpose + '</a></li>';
                            }
                        });

                        // set the new content and refresh the UI
                        $('#reports-list').append(content).listview('refresh');
                        
                        // hide loading spinner
                        $.mobile.hidePageLoadingMsg();
                });
            });
        </script>
        
        <!-- Start of Review Status page -->
        <div data-role="page" id="review-status" data-add-back-btn="true">
            
            <div data-role="header">
                <h1>Review Status</h1>
            </div><!-- /header -->
            
            <div data-role="content">
                <ul data-role="listview" id="reports-list">
                </ul>
            </div><!-- /content -->
            
            <div data-role="footer">
                <h4>Page Footer</h4>
            </div><!-- /footer -->
        </div><!-- /page -->
        
    </body>
</html>